<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PEGUE O NARO ‚Äì BANDIDO BOM √â BANDIDO PRESO</title>
<meta name="description" content="Jogo web: derrube a gaiola e prenda o Naro.">
<style>
  :root{
    --primary:#111827; --accent:#f59e0b; --text:#111;
    --hud-bg:#2b241d; --hud-chip:#ffffff; --hud-text:#111;
    --modal-bg:rgba(0,0,0,.5); --modal-card:#fff; --modal-text:#111;
    --btn-radius:16px; --btn-weight:800; --shadow:0 10px 30px rgba(0,0,0,.25);
    --donate:#00a307; --ok:#16a34a; --err:#dc2626;

    /* Layout do cr√©dito e offsets de seguran√ßa (iOS etc.) */
    --credit-h: 28px;
    --credit-gap: 8px;
    --safe-bottom: env(safe-area-inset-bottom, 0px);

    /* NOVO: Controle de altura */
    --naro-bottom: 200px;   /* quanto maior o valor, mais baixo fica o Naro */
    --cage-top: 10px;        /* quanto maior o valor, mais baixo fica a gaiola */
  }

  *{box-sizing:border-box}
  html,body{margin:0;height:100%;overflow:hidden}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;background:#000;color:var(--text)}
  button{cursor:pointer}
  img{display:block;max-width:100%}
  .hidden{display:none!important}
  .page{position:relative;height:100vh;width:100vw;overflow:hidden}
  .bg{position:absolute;inset:0;z-index:-2;background:#000 center/cover no-repeat}

  /* ======= TELA INICIAL ======= */
  .menu-logos{
    position:absolute;top:22px;left:22px;right:22px;z-index:6;
    display:flex;justify-content:space-between;gap:16px;align-items:flex-start;
  }
  .card-white{background:#fff;border-radius:26px;box-shadow:var(--shadow);padding:16px 20px}
  .menu-logo-left img{width:160px}
  .menu-logo-right img{width:300px}
  @media (max-width:1024px){ .menu-logo-left img{width:120px}.menu-logo-right img{width:240px} }

  .content{
    position:absolute; left:0; right:0; bottom:14vh;
    display:flex; flex-direction:column; align-items:center; gap:14px; padding:16px;
  }
  @media (max-width:767px){
    .content{
      bottom: calc(14vh + var(--credit-h) + var(--credit-gap) + var(--safe-bottom));
    }
  }

  /* Contadores */
  .counters{
    background:#fff; color:#111; border-radius:14px; padding:10px 14px;
    display:flex; gap:18px; font-weight:800; box-shadow:0 8px 24px rgba(0,0,0,.18);
  }
  .counters b{font-variant-numeric:tabular-nums}
  @media (min-width:768px){
    .counters{
      position:fixed; top:250px; left:50%; transform:translateX(-50%);
      z-index:1000;
    }
  }
  @media (max-width:767px){
    .counters{
      position:relative; margin:0 0 6px 0;
      flex-wrap:nowrap; justify-content:center;
      gap:10px; padding:6px 10px; font-size:12px; white-space:nowrap; max-width:92vw;
    }
  }

  .card{
    background:rgba(255,255,255,.75);backdrop-filter:blur(6px) saturate(1.2);
    border-radius:16px;padding:16px;width:min(560px,92vw);box-shadow:var(--shadow)
  }
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
  .input{width:100%;padding:14px 16px;font-size:16px;border-radius:12px;border:1px solid #e5e7eb;outline:0}
  .btn{background:var(--primary);color:#fff;padding:14px 20px;border:0;border-radius:var(--btn-radius);font-weight:var(--btn-weight);font-size:16px;transition:.15s}
  .btn:hover{background:var(--accent)}
  .btn.secondary{background:#fff;color:#111;border:1px solid #111}

  /* Helper */
  .helper{background:#fff;color:#111;border-radius:10px;padding:10px 14px;box-shadow:0 6px 20px rgba(0,0,0,.2);font-size:14px;text-align:center}
  .helper .only-desk{display:inline}
  .helper .only-mob{display:none}
  @media (max-width:767px){
    .helper .only-desk{display:none}
    .helper .only-mob{display:inline}
  }

  /* ======= JOGO ‚Äì DESKTOP ======= */
  .brand-left{
    position:absolute;top:24px;left:24px;z-index:7;
    display:flex;flex-direction:column;gap:12px;align-items:flex-start
  }
  .logo-game-card img{width:300px}
  .logo-arco img{width:140px}
  @media (max-width:1024px){ .logo-game-card img{width:240px}.logo-arco img{width:110px} }

  .top-right{
    position:absolute;top:16px;right:16px;z-index:7;display:flex;gap:12px;align-items:center;flex-wrap:wrap
  }
  .hud{display:flex;gap:10px;align-items:center;background:var(--hud-bg);padding:8px 10px;border-radius:14px;box-shadow:var(--shadow)}
  .pill{background:#d2b48c;color:#1c160f;padding:6px 12px;border-radius:12px;font-weight:900;display:flex;gap:6px;align-items:center}

  /* DOAR desktop */
  .donate-btn-desktop{
    display:inline-flex; align-items:center; justify-content:center;
    padding:12px 18px; border-radius:16px; background:var(--donate); color:#fff; text-decoration:none;
    box-shadow:var(--shadow); font-weight:800;
  }
  @media (max-width:767px){ .donate-btn-desktop{ display:none; } }

  /* Arena */
  .arena{position:absolute;inset:0;width:100vw;height:100vh;overflow:hidden}
  .arena .layer{position:absolute;inset:0}
  .sprite-img{max-width:100%;max-height:100%;object-fit:contain}

  .naro{position:absolute;left:0;display:flex;align-items:flex-end;justify-content:center;bottom: var(--naro-bottom);}
  .cage{position:absolute;top: var(--cage-top);left:0;transform:none;display:flex;align-items:flex-end;justify-content:center}

  .balloon{position:absolute;bottom:240px;padding:10px 12px;max-width:420px;border-radius:12px;background:#fff;border:1px solid rgba(17,17,17,.08);box-shadow:0 6px 20px rgba(0,0,0,.18);opacity:0;transform:translateY(6px);transition:.25s;white-space:nowrap;pointer-events:none}
  .balloon.show{opacity:1;transform:translateY(0)}

  /* ======= MOBILE ======= */
  @media (max-width:767px){
    .top-mobile-hud{position:absolute;top:8px;left:8px;right:8px;z-index:9;display:flex;gap:10px;justify-content:space-between;}
    .top-mobile-hud .box{background:#fff;border-radius:12px;height:28px;flex:1;box-shadow:0 6px 20px rgba(0,0,0,.12);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:13px;color:#111;padding:0 8px;min-width:0;}
    .brand-left{top:58px; left:10px; right:10px;flex-direction:row; justify-content:space-between; align-items:center; gap:10px;}
    .logo-game-card{padding:10px 12px;border-radius:18px;background:#fff;box-shadow:var(--shadow)}
    .logo-game-card img{width:100px}
    .logo-arco img{width:60px}
    .top-right .hud{display:none}
    .balloon{bottom:188px;max-width:280px}
    .mobile-drop .row-mobile-actions{display:flex; gap:10px; align-items:center; justify-content:center;}
    .mobile-drop .row-mobile-actions .btn{ flex:1; }
    .donate-btn-mobile{display:inline-flex; align-items:center; justify-content:center;padding:12px 16px; border-radius:16px; background:var(--donate); color:#fff; text-decoration:none;box-shadow:var(--shadow); font-weight:800; white-space:nowrap;}
  }
  @media (min-width:768px){ .top-mobile-hud{ display:none !important; } }

  .mobile-drop{position:fixed;left:50%;transform:translateX(-50%);bottom: calc(250px + var(--credit-h) + var(--credit-gap) + var(--safe-bottom));width:90vw;max-width:560px;z-index:30;}
  @media (min-width:768px){.mobile-drop{display:none}}

  .overlay{position:fixed;inset:0;background:var(--modal-bg);display:none;align-items:center;justify-content:center;z-index:50}
  .overlay.show{display:flex}
  .modal{background:var(--modal-card);color:var(--modal-text);border-radius:18px;width:min(520px,92vw);padding:22px;text-align:center;box-shadow:0 14px 50px rgba(0,0,0,.35)}
  .modal h2{margin:0 0 8px; display:flex; gap:8px; align-items:center; justify-content:center;}
  .modal h2.success{color:var(--ok)}
  .modal h2.error{color:var(--err)}
  .modal .actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:14px}

  /* Cr√©ditos */
  .credit{position:fixed; left:50%; transform:translateX(-50%); bottom: max(2px, var(--safe-bottom)); z-index:60; font-size:12px; font-weight:800; color:#111; text-decoration:none; padding:4px 8px; border-radius:8px; background:#fff; border:1px solid #e5e7eb; white-space:nowrap;}
  .credit:hover{text-decoration:underline}
</style>
</head>
<body>
<!-- ========== MENU ========== -->
<section id="menuPage" class="page">
  <div id="menuBg" class="bg"></div>

  <div class="menu-logos">
    <div class="menu-logo-left"><img id="menuLogoLeft" alt="Logo ARCO"></div>
    <div class="menu-logo-right card-white"><img id="menuLogoRight" alt="Logo do jogo"></div>
  </div>

  <div class="content">
    <div id="globalCounters" class="counters">
      <div>JOGADO: <b id="playedCount">0</b> VEZES</div>
      <div>NARO PEGO: <b id="winCount">0</b> VEZES</div>
    </div>

    <div class="card">
      <div class="row" style="margin-bottom:10px">
        <input id="userName" class="input" placeholder="Seu nome" autocomplete="name" />
      </div>
      <div class="row">
        <button id="startBtn" class="btn">Iniciar</button>
        <a class="btn secondary" href="https://www.ongarco.org/quero-ajudar" target="_blank" rel="noopener">DOAR AGORA</a>
      </div>
    </div>

    <div class="helper">
      <span class="only-desk">PC: use a <b>Barra de Espa√ßo</b> ‚Ä¢ Celular: toque em <b>Pegue o Naro</b></span>
      <span class="only-mob">PC: use a <b>Barra de Espa√ßo</b><br>Celular: toque em <b>Pegue o Naro</b></span>
    </div>
  </div>
</section>

<!-- ========== JOGO ========== -->
<section id="gamePage" class="page hidden">
  <div id="gameBg" class="bg"></div>

  <div class="top-mobile-hud">
    <div class="box">‚è± <span id="time">00:00</span></div>
    <div class="box">‚ö° <span id="speed">0</span></div>
    <div class="box">‚≠ê <span id="score">0</span></div>
    <div class="box">üéØ <span id="level">1</span></div>
  </div>

  <div class="brand-left">
    <div class="logo-game-card card-white"><img id="gameLogoCard" alt="Logo do jogo"></div>
    <div class="logo-arco"><img id="gameLogoLeft" alt="Logo ARCO"></div>
    <a class="donate-btn-desktop" href="https://www.ongarco.org/quero-ajudar" target="_blank" rel="noopener">DOAR AGORA</a>
  </div>

  <div class="top-right">
    <div class="hud">
      <div class="pill pill-time">‚è± <b id="timeDesk">00:00</b></div>
      <div class="pill pill-speed">‚ö° <b id="speedDesk">0</b></div>
      <div class="pill pill-score">‚≠ê <b id="scoreDesk">0</b></div>
      <div class="pill pill-level">üéØ <b id="levelDesk">1</b></div>
    </div>
  </div>

  <div class="arena" id="arena">
    <div class="layer">
      <div class="naro" id="naro"><img id="naroImg" class="sprite-img" alt="Naro"></div>
      <div class="cage" id="cage"><img id="cageImg" class="sprite-img" alt="Gaiola"></div>
      <div class="balloon" id="balloon"></div>
    </div>
  </div>

  <div class="mobile-drop">
    <div class="row-mobile-actions">
      <button id="mobileDropBtn" class="btn" style="width:100%;">Pegue o Naro</button>
      <a class="donate-btn-mobile" href="https://www.ongarco.org/quero-ajudar" target="_blank" rel="noopener">DOAR</a>
    </div>
  </div>
</section>

<!-- MODAL -->
<div id="overlay" class="overlay" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 id="modalTitle" class="">
      <span id="modalIcon" aria-hidden="true">‚ÑπÔ∏è</span>
      <span id="modalTitleText">Resultado</span>
    </h2>
    <p id="modalMsg">Mensagem</p>
    <div class="actions">
      <button id="modalAction" class="btn">TENTAR SALVAR A DEMOCRACIA NOVAMENTE</button>
    </div>
  </div>
</div>

<a class="credit" href="https://www.instagram.com/umcarlossantos/" target="_blank" rel="noopener">
  DESENVOLVIDO POR: @umcarlossantos
</a>

<!-- ========== SCRIPT DO JOGO ========== -->
<script>
/** ====== ASSETS ====== **/
const ASSETS = {
  bgDesktop: './bg-desktop.jpg',
  bgMobile:  './bg-mobile.jpg',
  naro:      './naro.png',
  logoGame:  './logo-game.png',
  cage:      './cage.png',
  logoMenu:  './logo-menu.png'
};

const NARO_W0=480, NARO_H0=1080;
const CAGE_W0=864, CAGE_H0=1080;

const RATIO_DESK = { cageH: 0.40, naroH: 0.35 };
const RATIO_MOB  = { cageH: 0.22, naroH: 0.20 };

let state = { userName:'', level:1, score:0, startedAt:0, elapsed:0, playing:false, dir:1, x:0, vx:0, naroW:0, naroH:0, cageDir:1, cageX:0, cageDropping:false, cageW:0, cageH:0, suspendedTop:0, lastWin:null };

const params = { baseSpeed: 360, speedIncreasePerLevel: 90, speedRampByTime: 0.018, cagePatrolSpeed: 260, dropSpeed: 1100, hitboxInnerPadding:14, minOverlapToCaptureMobile:0.60, minOverlapToCaptureDesktop:0.75, balloonIntervalRangeMs:[4000,9000], balloonDurationMs:2500, balloons:["Isso nunca vai dar em nada!","Acabou a mamata?!","Eu sou imbroch√°vel!","Fake news!"], transparentWhiteThreshold:242 };

function $(id){return document.getElementById(id)}
function clamp(v,min,max){return Math.max(min, Math.min(max,v))}
function fmtTime(sec){const m=Math.floor(sec/60), s=Math.floor(sec%60); return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;}
function isMobile(){ return window.matchMedia('(max-width: 767px)').matches; }
function currentBg(){ return isMobile()? (ASSETS.bgMobile || ASSETS.bgDesktop) : (ASSETS.bgDesktop || ASSETS.bgMobile); }

/** Sprites */
function layoutSprites(){
  const arena = $('arena').getBoundingClientRect();
  const R = isMobile()? RATIO_MOB : RATIO_DESK;

  const cageH = Math.round(arena.height * R.cageH);
  const sCage = cageH / CAGE_H0; const cageW = Math.round(CAGE_W0 * sCage);
  const naroH = Math.round(arena.height * R.naroH);
  const sNaro = naroH / NARO_H0; const naroW = Math.round(NARO_W0 * sNaro);

  state.cageH=cageH; state.cageW=cageW; state.naroH=naroH; state.naroW=naroW;

  $('cage').style.width=cageW+'px'; $('cage').style.height=cageH+'px';
  $('naro').style.width=naroW+'px'; $('naro').style.height=naroH+'px';
}

function showMenu(){ $('menuPage').classList.remove('hidden'); $('gamePage').classList.add('hidden'); $('overlay').classList.remove('show'); state.playing=false; state.cageDropping=false; }
function showGame(){ $('menuPage').classList.add('hidden'); $('gamePage').classList.remove('hidden'); $('overlay').classList.remove('show'); }

/** Bal√µes */
let balloonTimer=null;
function scheduleBalloon(){
  clearTimeout(balloonTimer);
  if(!params.balloons.length) return;
  const [min,max]=params.balloonIntervalRangeMs;
  const wait=Math.floor(min + Math.random()*(max-min));
  balloonTimer=setTimeout(()=>{
    const t=params.balloons[Math.floor(Math.random()*params.balloons.length)];
    const b=$('balloon'); b.textContent=t; b.classList.add('show');
    setTimeout(()=>b.classList.remove('show'), params.balloonDurationMs);
    scheduleBalloon();
  }, wait);
}

/** Captura */
function getInnerCageRect(){ const cage=$('cage').getBoundingClientRect(); const pad=params.hitboxInnerPadding; return {left:cage.left+pad,right:cage.right-pad,top:cage.top+pad,bottom:cage.bottom-pad}; }
function getNaroRect(){ return $('naro').getBoundingClientRect(); }
function naroCaptured(){
  const inner=getInnerCageRect(), n=getNaroRect();
  const fully = (n.left>=inner.left && n.right<=inner.right && n.top>=inner.top && n.bottom<=inner.bottom);
  if(fully) return true;
  const cx=(n.left+n.right)/2, cy=(n.top+n.bottom)/2;
  const centerInside = (cx>=inner.left && cx<=inner.right && cy>=inner.top && cy<=inner.bottom);
  if(!centerInside) return false;
  const vOverlap = Math.max(0, Math.min(inner.bottom, n.bottom) - Math.max(inner.top, n.top));
  const nH = (n.bottom - n.top) || 1;
  const threshold = isMobile() ? params.minOverlapToCaptureMobile : params.minOverlapToCaptureDesktop;
  return (vOverlap / nH) >= threshold;
}

/** Jogo */
function resetRound(){
  state.startedAt=performance.now(); state.elapsed=0; state.dir = Math.random()<0.5 ? -1 : 1; state.vx=0; state.cageDir = Math.random()<0.5 ? -1 : 1; state.cageDropping=false; layoutSprites(); updateHUD(); scheduleBalloon();
}
function currentSpeed(){ const base=params.baseSpeed + params.speedIncreasePerLevel*(state.level-1); const ramp=1 + params.speedRampByTime * (state.elapsed/1000); return base*ramp; }
function updateHUD(){ const t = fmtTime(state.elapsed/1000); const sp = Math.round(currentSpeed()); $('time').textContent=t; $('timeDesk').textContent=t; $('level').textContent=state.level; $('levelDesk').textContent=state.level; $('speed').textContent=sp; $('speedDesk').textContent=sp; $('score').textContent=state.score; $('scoreDesk').textContent=state.score; }
function dropCage(){ if(state.playing && !state.cageDropping){ state.cageDropping=true; } }
function cageGroundY(){ const arena = $('arena').getBoundingClientRect(); const naroBottom = parseFloat(getComputedStyle($('naro')).bottom) || 0; const pad = 0; return arena.height - state.cageH - naroBottom - pad; }

/** Loop */
let raf=null;
function loop(ts){
  if(!state.playing){ raf=requestAnimationFrame(loop); return; }
  if(!state.startedAt) state.startedAt=ts;
  state.elapsed=ts-state.startedAt;

  const arena=$('arena').getBoundingClientRect();
  const naroEl=$('naro'); const cageEl=$('cage');

  const v=currentSpeed(); state.vx=v*(1/60);
  state.x += state.vx*state.dir;
  const maxNaroX = arena.width - state.naroW;
  if(state.x < 0){ state.x = 0; state.dir = 1; }
  else if(state.x > maxNaroX){ state.x = maxNaroX; state.dir = -1; }
  naroEl.style.left = Math.round(state.x)+'px';

  if(!state.cageDropping){
    const patrolV=(params.cagePatrolSpeed + 30*(state.level-1))*(1/60);
    const maxCageX = arena.width - state.cageW;
    let x = Number(cageEl.dataset.x ?? (arena.width*0.72 - state.cageW/2));
    x += patrolV*state.cageDir;
    if(x < 0){ x = 0; state.cageDir = 1; }
    else if(x > maxCageX){ x = maxCageX; state.cageDir = -1; }
    cageEl.dataset.x = x;
    cageEl.style.left = Math.round(x)+'px';
  }

  if(state.cageDropping){
    const curTop=parseFloat(getComputedStyle(cageEl).top);
    const step=params.dropSpeed*(1/60);
    const ground = cageGroundY();
    const next=Math.min(curTop+step, ground);
    cageEl.style.top=next+'px';
    if(next>=ground){
      state.cageDropping=false;
      showResult(naroCaptured());
    }
  }

  updateHUD();
  raf=requestAnimationFrame(loop);
}

function showResult(win){
  state.playing=false;
  state.lastWin = win;
  const name=state.userName||'Voc√™';
  $('overlay').classList.add('show');
  const title = $('modalTitle'); const icon  = $('modalIcon'); const ttext = $('modalTitleText');
  title.classList.remove('success','error');
  if(win){ window.incWin && window.incWin(); ttext.textContent = 'Parab√©ns!'; title.classList.add('success'); icon.textContent = '‚úÖ'; $('modalMsg').textContent = `Parab√©ns, ${name}, voc√™ ajudou a salvar a nossa democracia!`; state.score += 100; }
  else{ state.level = 1; ttext.textContent = 'FALHOU'; title.classList.add('error'); icon.textContent = '‚ùå'; $('modalMsg').textContent = `${name} VOC√ä FALHOU E O NARO EST√Å SOLTO. TENTE NOVAMENTE PARA SALVAR A DEMOCRACIA.`; }
  $('modalAction').textContent = 'TENTAR SALVAR A DEMOCRACIA NOVAMENTE';
}

/** Controles */
$('startBtn').addEventListener('click', startGame);
const mobileBtn=$('mobileDropBtn'); if(mobileBtn) mobileBtn.addEventListener('click', dropCage);
document.addEventListener('keydown',(e)=>{
  if(e.code==='Space' && !$('menuPage').classList.contains('hidden')){ e.preventDefault(); startGame(); return; }
  if(e.code==='Space' && state.playing){ e.preventDefault(); dropCage(); }
});
$('modalAction').addEventListener('click', ()=>{ $('overlay').classList.remove('show'); if (state.lastWin === false) { window.incPlayed && window.incPlayed(); state.level = 1; } else if (state.lastWin === true) { state.level++; } state.playing = true; resetRound(); });

function startGame(){ state.userName = $('userName').value.trim(); state.level = state.level || 1; state.playing = true; state.lastWin = null; window.incPlayed && window.incPlayed(); $('overlay').classList.remove('show'); showGame(); resetRound(); }

function init(){ showMenu(); layoutSprites(); loop(0); }
init();
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA8Ab-sVO3yagkZkKgYTr5bbTBhll9stpQ",
    authDomain: "peguenaro.firebaseapp.com",
    databaseURL: "https://peguenaro-default-rtdb.firebaseio.com",
    projectId: "peguenaro",
    storageBucket: "peguenaro.firebasestorage.app",
    messagingSenderId: "349978296089",
    appId: "1:349978296089:web:3ad31deace7b55c7ff8f88"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const playsRef = ref(db, "counters/plays");
  const winsRef  = ref(db, "counters/wins");

  onValue(playsRef, (snap)=>{ const v = snap.val() ?? 0; const el = document.getElementById("playedCount"); if (el) el.textContent = v; });
  onValue(winsRef, (snap)=>{ const v = snap.val() ?? 0; const el = document.getElementById("winCount"); if (el) el.textContent = v; });

  window.incPlayed = () => runTransaction(playsRef, (cur)=> (cur||0)+1);
  window.incWin    = () => runTransaction(winsRef,  (cur)=> (cur||0)+1);
</script>
</body>
</html>
