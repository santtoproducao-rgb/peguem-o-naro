<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PEGUEM O NARO ‚Äì BANDIDO BOM √â BANDIDO PRESO</title>
<meta name="description" content="Jogo web: derrube a gaiola e prenda o Naro.">
<style>
  :root{
    --primary:#111827; --accent:#f59e0b; --text:#111111;
    --glass:rgba(255,255,255,.18); --glass-strong:rgba(255,255,255,.65);
    --hud-bg:rgba(18,18,18,.35); --hud-text:#f5f5f5;
    --modal-bg:rgba(0,0,0,.5); --modal-card:#ffffff; --modal-text:#111111;
    --btn-radius:14px; --btn-weight:800;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;overflow:hidden}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;background:#000;color:var(--text)}
  button{cursor:pointer}
  img{display:block;max-width:100%}

  .app{height:100vh;display:flex;flex-direction:column}
  .hidden{display:none!important}

  .page{
    position:relative; height:100vh; width:100vw;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    overflow:hidden;
  }
  .bg{position:absolute; inset:0; z-index:-2; background:#000 center/cover no-repeat}

  /* ==== MENU ==== */
  .menu-logo-fixed{
    position:absolute; top:14px; left:14px; z-index:5;
    background:var(--glass-strong); border-radius:12px; padding:6px;
    backdrop-filter:blur(6px) saturate(1.2);
  }
  .menu-logo-fixed img{width:120px; height:auto}
  @media (max-width:767px){ .menu-logo-fixed img{width:90px} }

  .content{
    width:100%;max-width:1024px;padding:16px;
    display:flex;flex-direction:column;gap:16px;align-items:center;text-align:center
  }
  .logo-game{max-width:320px;max-height:320px}
  @media (max-width:767px){ .logo-game{max-width:240px;max-height:240px} }

  .card{
    background:var(--glass-strong);backdrop-filter:blur(6px) saturate(1.2);
    border-radius:16px; padding:16px; width:min(560px,92vw);
    box-shadow:0 10px 30px rgba(0,0,0,.25)
  }
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
  .input{width:100%; padding:14px 16px; font-size:16px; border-radius:12px; border:1px solid #e5e7eb; outline:0}
  .btn{background:var(--primary); color:#fff; padding:14px 20px; border:0; border-radius:var(--btn-radius); font-weight:var(--btn-weight); font-size:16px; transition:.15s}
  .btn:hover{background:var(--accent)}
  .btn.secondary{background:#fff;color:#111;border:1px solid #111}
  .helper{color:#f9fafb;font-size:14px;opacity:.95;margin-top:6px;text-shadow:0 1px 3px rgba(0,0,0,.35)}

  /* ==== JOGO ==== */
  .topbar{
    position:absolute; top:10px; left:10px; right:10px; z-index:7;
    display:flex; align-items:center; justify-content:space-between;
  }
  .game-logo-left{
    background:var(--glass-strong); border-radius:12px; padding:6px;
    backdrop-filter:blur(6px) saturate(1.2);
  }
  .game-logo-left img{width:140px; height:auto}
  @media (max-width:767px){ .game-logo-left img{width:100px} }

  .donate-btn{white-space:nowrap}

  /* HUD moderno no topo direito */
  .hud-top{
    position:absolute; top:10px; right:10px; z-index:7;
    display:flex; gap:10px; align-items:center; flex-wrap:wrap;
  }
  .pill{
    color:var(--hud-text);
    background:var(--hud-bg); border:1px solid rgba(255,255,255,.18);
    padding:8px 12px; border-radius:12px; font-weight:800;
    text-shadow:0 1px 2px rgba(0,0,0,.35); backdrop-filter:blur(8px) saturate(1.25);
    display:flex; gap:6px; align-items:center;
  }

  /* Arena */
  .arena{position:relative; width:min(1200px, 90vw); height:min(74vh, 780px); border-radius:16px; overflow:hidden}
  .arena .layer{position:absolute; inset:0}

  .sprite-img{max-width:100%; max-height:100%; object-fit:contain; background:transparent}

  .naro{
    position:absolute; bottom:12px; left:0;
    width:190px; height:auto; display:flex; align-items:flex-end; justify-content:center;
  }

  .cage{
    position:absolute; top:8px; /* sempre vis√≠vel no topo */
    left:50%; transform:translateX(-50%);
    width:380px; height:460px; display:flex; align-items:flex-end; justify-content:center;
  }

  .balloon{
    position:absolute; bottom:240px; padding:10px 12px; max-width:420px; border-radius:12px;
    background:#fff; border:1px solid rgba(17,17,17,.1); box-shadow:0 6px 20px rgba(0,0,0,.18);
    opacity:0; transform:translateY(6px); transition:.25s; white-space:nowrap;
  }
  .balloon.show{opacity:1; transform:translateY(0)}
  @media (max-width:767px){
    .arena{width:95vw; height:66vh}
    .naro{width:160px}
    .cage{width:310px; height:380px}
    .balloon{max-width:300px; bottom:210px; white-space:normal}
  }

  .mobile-drop{position:fixed; left:50%; transform:translateX(-50%); bottom:16px; width:80vw; max-width:480px; z-index:30}
  @media (min-width:768px){ .mobile-drop{display:none} }

  /* Modal */
  .overlay{position:fixed; inset:0; background:var(--modal-bg); display:none; align-items:center; justify-content:center; z-index:50}
  .overlay.show{display:flex}
  .modal{background:var(--modal-card); color:var(--modal-text); border-radius:18px; width:min(520px,92vw); padding:22px; text-align:center; box-shadow:0 14px 50px rgba(0,0,0,.35)}
  .modal h2{margin:0 0 8px}
  .modal .actions{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:14px}
</style>
</head>
<body>
<div class="app" id="app">
  <!-- ===== MENU ===== -->
  <section id="menuPage" class="page">
    <div id="menuBg" class="bg"></div>

    <!-- logo-menu no topo esquerdo -->
    <div class="menu-logo-fixed">
      <img id="menuLogoTop" alt="Logo pequeno">
    </div>

    <div class="content">
      <!-- apenas o logo do jogo no centro -->
      <img id="menuLogoGame" class="logo-game" alt="Logo do jogo">

      <div class="card">
        <div class="row" style="margin-bottom:10px">
          <input id="userName" class="input" placeholder="Seu nome" autocomplete="name" />
        </div>
        <div class="row">
          <button id="startBtn" class="btn">Iniciar</button>
          <a id="donateMenu" class="btn secondary" href="https://www.ongarco.org/quero-ajudar" target="_blank" rel="noopener">DOAR AGORA</a>
        </div>
      </div>
      <div class="helper">PC: use a <b>Barra de Espa√ßo</b> ‚Ä¢ Celular: toque em <b>Pegue o Naro</b></div>
    </div>
  </section>

  <!-- ===== JOGO ===== -->
  <section id="gamePage" class="page hidden">
    <div id="gameBg" class="bg"></div>

    <!-- Logo √† esquerda + bot√£o doar √† direita -->
    <div class="topbar">
      <div class="game-logo-left"><img id="gameLogoLeft" alt="Logo do projeto"></div>
      <a id="donateGame" class="btn donate-btn" href="https://www.ongarco.org/quero-ajudar" target="_blank" rel="noopener">DOAR AGORA</a>
    </div>

    <!-- HUD moderno topo direito -->
    <div class="hud-top">
      <div class="pill">‚è± <b id="time">00:00</b></div>
      <div class="pill">‚ö° Vel: <b id="speed">0</b></div>
      <div class="pill">‚≠ê Score: <b id="score">0</b></div>
      <div class="pill">üéØ N√≠vel: <b id="level">1</b></div>
    </div>

    <div class="arena" id="arena">
      <div class="layer">
        <div class="naro" id="naro"><img id="naroImg" class="sprite-img" alt="Naro"></div>
        <div class="cage" id="cage"><img id="cageImg" class="sprite-img" alt="Gaiola"></div>
        <div class="balloon" id="balloon"></div>
      </div>
    </div>

    <div class="mobile-drop">
      <button id="mobileDropBtn" class="btn" style="width:100%;">Pegue o Naro</button>
    </div>
  </section>
</div>

<!-- MODAL -->
<div id="overlay" class="overlay" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 id="modalTitle">Resultado</h2>
    <p id="modalMsg">Mensagem</p>
    <div class="actions">
      <button id="modalPrimary" class="btn">Pr√≥ximo n√≠vel</button>
      <button id="modalSecondary" class="btn secondary">SALVAR A DEMOCRACIA</button>
    </div>
  </div>
</div>

<script>
/** ====== ARQUIVOS ====== **/
const ASSETS = {
  bgDesktop: './bg-desktop.jpg',
  bgMobile:  './bg-mobile.jpg',
  naro:      './naro.png',
  logoGame:  './logo-game.png',
  cage:      './cage.png',
  logoMenu:  './logo-menu.png'
};

/** ====== ESTADO / PAR√ÇMETROS ====== **/
let state = {
  userName:'', level:1, score:0,
  startedAt:0, elapsed:0, playing:false,
  // Naro
  dir:1, x:0, vx:0,
  // Gaiola
  cageDir:1, cageX:0, cageDropping:false
};

const params = {
  baseSpeed:220, speedIncreasePerLevel:60, speedRampByTime:0.012,
  cagePatrolSpeed:180,   // velocidade horizontal da gaiola
  dropSpeed:980,         // velocidade vertical da queda
  hitboxPadding:10,
  balloonIntervalRangeMs:[4000,9000], balloonDurationMs:2500,
  balloons:["Isso nunca vai dar em nada!","Acabou a mamata?!","Eu sou imbroch√°vel!","Fake news!"],
  transparentWhiteThreshold: 242 // para ‚Äúgarantir‚Äù transpar√™ncia se houver branco residual
};

function $(id){return document.getElementById(id)}
function clamp(v,min,max){return Math.max(min, Math.min(max,v))}
function fmtTime(sec){const m=Math.floor(sec/60), s=Math.floor(sec%60); return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;}
function isMobile(){ return window.matchMedia('(max-width: 767px)').matches; }
function currentBg(){ return isMobile()? (ASSETS.bgMobile || ASSETS.bgDesktop) : (ASSETS.bgDesktop || ASSETS.bgMobile); }

/** ====== GARANTIA DE TRANSPAR√äNCIA ======
 * Converte branco ‚Äúquase puro‚Äù em alfa 0 (caso exista). Mant√©m PNG com alfa.
 */
function makeWhiteTransparent(url, threshold=params.transparentWhiteThreshold){
  return new Promise((resolve)=>{
    const img = new Image(); img.crossOrigin = 'anonymous';
    img.onload = ()=>{
      // Verifica rapidamente se j√° h√° alfa ‚Äì se sim, retorna direto
      const canvas = document.createElement('canvas');
      canvas.width = img.width; canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img,0,0);
      const imgData = ctx.getImageData(0,0,1,1).data;
      // N√£o h√° jeito 100% simples de detectar alfa global, ent√£o aplicamos filtro leve
      const full = ctx.getImageData(0,0,canvas.width,canvas.height);
      const d = full.data;
      let changed = false;
      for(let i=0;i<d.length;i+=4){
        const r=d[i], g=d[i+1], b=d[i+2];
        if(r>=threshold && g>=threshold && b>=threshold){
          d[i+3]=0; changed = true;
        }
      }
      if(changed){ ctx.putImageData(full,0,0); resolve(canvas.toDataURL('image/png')); }
      else resolve(url);
    };
    img.onerror = ()=>resolve(url);
    img.src = url + '?v=' + Date.now();
  });
}

/** ====== UI ====== **/
async function loadImages(){
  const bg = currentBg();
  $('menuBg').style.backgroundImage = `url(${bg})`;
  $('gameBg').style.backgroundImage = `url(${bg})`;

  $('menuLogoTop').src   = ASSETS.logoMenu;
  $('menuLogoGame').src  = ASSETS.logoGame;
  $('gameLogoLeft').src  = ASSETS.logoMenu;

  // sprites com garantia de transpar√™ncia
  $('naroImg').src = await makeWhiteTransparent(ASSETS.naro);
  $('cageImg').src = await makeWhiteTransparent(ASSETS.cage);
}
function showMenu(){ $('menuPage').classList.remove('hidden'); $('gamePage').classList.add('hidden'); $('overlay').classList.remove('show'); state.playing=false; state.cageDropping=false; }
function showGame(){ $('menuPage').classList.add('hidden'); $('gamePage').classList.remove('hidden'); $('overlay').classList.remove('show'); }

/** ====== BAL√ïES ====== **/
let balloonTimer=null;
function scheduleBalloon(){
  clearTimeout(balloonTimer);
  if(!params.balloons.length) return;
  const [min,max]=params.balloonIntervalRangeMs;
  const wait=Math.floor(min + Math.random()*(max-min));
  balloonTimer=setTimeout(()=>{
    const t=params.balloons[Math.floor(Math.random()*params.balloons.length)];
    showBalloon(t);
    setTimeout(hideBalloon, params.balloonDurationMs);
    scheduleBalloon();
  }, wait);
}
function showBalloon(t){
  const b=$('balloon'); b.textContent=t;
  const naro=$('naro').getBoundingClientRect();
  const arena=$('arena').getBoundingClientRect();
  const left=clamp((naro.left-arena.left)+naro.width/2-120, 8, arena.width-250);
  b.style.left=left+'px';
  b.classList.add('show');
}
function hideBalloon(){ $('balloon').classList.remove('show'); }

/** ====== JOGO ====== **/
function resetRound(){
  state.startedAt=performance.now();
  state.elapsed=0;
  state.dir=1; state.x=0; state.vx=0;
  state.cageDir = Math.random() < 0.5 ? -1 : 1;
  state.cageDropping=false;

  $('naro').style.left='0px';
  $('cage').style.top='8px';

  // posiciona gaiola no centro ao iniciar
  const arena=$('arena').getBoundingClientRect();
  const cageW = $('cage').getBoundingClientRect().width || 380;
  const startX = (arena.width/2 - cageW/2);
  $('cage').dataset.x = startX;
  $('cage').style.left = startX + 'px';
  $('cage').style.transform = ''; // sem translate

  updateHUD(); scheduleBalloon();
}
function currentSpeed(){
  const base=params.baseSpeed + params.speedIncreasePerLevel*(state.level-1);
  const ramp=1 + params.speedRampByTime * (state.elapsed/1000);
  return base*ramp;
}
function updateHUD(){
  $('time').textContent = fmtTime(state.elapsed/1000);
  $('level').textContent = state.level;
  $('speed').textContent = Math.round(currentSpeed());
  $('score').textContent = state.score;
}
function dropCage(){ if(state.playing && !state.cageDropping){ state.cageDropping=true; } }
function rectsIntersect(a,b){ return !(b.left>a.right || b.right<a.left || b.top>a.bottom || b.bottom<a.top); }
function checkResult(){
  const cage=$('cage').getBoundingClientRect();
  const naro=$('naro').getBoundingClientRect();
  const pad=params.hitboxPadding||0;
  const cageBase={left:cage.left+pad, right:cage.right-pad, top:cage.bottom-30, bottom:cage.bottom};
  const naroBox={left:naro.left+pad, right:naro.right-pad, top:naro.top+pad, bottom:naro.bottom};
  return rectsIntersect(cageBase, naroBox);
}

let raf=null;
function loop(ts){
  if(!state.playing){ raf=requestAnimationFrame(loop); return; }
  if(!state.startedAt) state.startedAt=ts;
  state.elapsed=ts-state.startedAt;

  const arena=$('arena').getBoundingClientRect();
  const naroEl=$('naro'); const cageEl=$('cage');

  // Naro ping-pong
  const v=currentSpeed(); state.vx=v*(1/60);
  state.x += state.vx*state.dir;
  const maxX = arena.width - naroEl.getBoundingClientRect().width - 6;
  if(state.x<0){ state.x=0; state.dir=1; }
  if(state.x>maxX){ state.x=maxX; state.dir=-1; }
  naroEl.style.left = `${state.x}px`;

  // Patrulha da gaiola (se n√£o estiver caindo)
  if(!state.cageDropping){
    const patrolV = (params.cagePatrolSpeed + 30*(state.level-1))*(1/60);
    const cageW = cageEl.getBoundingClientRect().width;
    const minX = 0; const maxX2 = arena.width - cageW;
    let x = Number(cageEl.dataset.x || (arena.width/2 - cageW/2));
    x += patrolV*state.cageDir;
    if(x < minX){ x=minX; state.cageDir=1; }
    if(x > maxX2){ x=maxX2; state.cageDir=-1; }
    cageEl.dataset.x = x;
    cageEl.style.left = x + 'px';
  }

  // Queda da gaiola
  if(state.cageDropping){
    const curTop = parseFloat(getComputedStyle(cageEl).top);
    const step = params.dropSpeed*(1/60);
    const ground = arena.height - cageEl.getBoundingClientRect().height + 6;
    const next = Math.min(curTop + step, ground);
    cageEl.style.top = next + 'px';
    if(next>=ground){
      state.cageDropping=false;
      showResult(checkResult());
    }
  }

  updateHUD();
  raf=requestAnimationFrame(loop);
}

function showResult(win){
  state.playing=false;
  const name=state.userName||'Voc√™';
  $('overlay').classList.add('show');
  if(win){
    $('modalTitle').textContent='Parab√©ns!';
    $('modalMsg').textContent=`Parab√©ns, ${name}, voc√™ ajudou a salvar a nossa democracia!`;
    $('modalPrimary').textContent='Pr√≥ximo n√≠vel';
    $('modalSecondary').classList.add('hidden');
    state.score+=100;
  }else{
    $('modalTitle').textContent='Falhou';
    $('modalMsg').textContent=`${name} VOC√ä FALHOU E O NARO EST√Å SOLTO. TENTE NOVAMENTE PARA SALVAR A DEMOCRACIA.`;
    $('modalPrimary').textContent='Tentar novamente';
    $('modalSecondary').textContent='SALVAR A DEMOCRACIA';
    $('modalSecondary').classList.remove('hidden');
  }
}

/** ====== CONTROLES ====== **/
$('startBtn').addEventListener('click', startGame);
$('mobileDropBtn')?.addEventListener('click', dropCage);
document.addEventListener('keydown',(e)=>{
  if(e.code==='Space' && !$('menuPage').classList.contains('hidden')){ e.preventDefault(); startGame(); return; }
  if(e.code==='Space' && state.playing){ e.preventDefault(); dropCage(); }
});
$('modalPrimary').addEventListener('click', ()=>{ $('overlay').classList.remove('show'); if(state.score>0){ state.level++; } state.playing=true; resetRound(); });
$('modalSecondary').addEventListener('click', ()=>{ $('overlay').classList.remove('show'); state.playing=true; resetRound(); });

function startGame(){
  state.userName = $('userName').value.trim();
  state.level = state.level || 1;
  state.playing = true;
  $('overlay').classList.remove('show');
  showGame(); resetRound();
}

/** ====== BOOT ====== **/
function init(){ loadImages(); showMenu(); loop(0); }
init();
</script>
</body>
</html>




