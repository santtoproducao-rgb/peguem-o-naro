<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PEGUE O NARO ‚Äì BANDIDO BOM √â BANDIDO PRESO</title>
<meta name="description" content="Jogo web: derrube a gaiola e prenda o Naro.">
<style>
  :root{
    --primary:#111827; --accent:#f59e0b; --text:#111111;
    --glass:rgba(255,255,255,.18); --glass-strong:rgba(255,255,255,.65);
    --hud-bg:#2b241d; --hud-chip:#d2b48c; /* marrom/bronzeado do mock */
    --hud-text:#f5f5f5;
    --modal-bg:rgba(0,0,0,.5); --modal-card:#ffffff; --modal-text:#111111;
    --btn-radius:14px; --btn-weight:800;
    --shadow:0 10px 30px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;overflow:hidden}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;background:#000;color:var(--text)}
  button{cursor:pointer}
  img{display:block;max-width:100%}

  .app{height:100vh;display:flex;flex-direction:column}
  .hidden{display:none!important}

  .page{position:relative;height:100vh;width:100vw;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}
  .bg{position:absolute;inset:0;z-index:-2;background:#000 center/cover no-repeat}

  /* ====== CART√ïES/LOGOS ====== */
  .card-white{background:#fff;border-radius:26px;box-shadow:var(--shadow);padding:16px 20px}
  .badge{background:#fff;border-radius:12px;padding:6px 10px;box-shadow:var(--shadow)}

  /* ====== MENU (imagem 2) ====== */
  .menu-logos{
    position:absolute;top:22px;left:22px;right:22px;z-index:6;
    display:flex;align-items:flex-start;justify-content:space-between;gap:16px;
  }
  .menu-logo-left img{width:160px;height:auto}
  .menu-logo-right img{width:300px;height:auto}
  @media (max-width:1024px){
    .menu-logo-right img{width:220px}
    .menu-logo-left img{width:120px}
  }

  .content{width:100%;max-width:1024px;padding:16px;display:flex;flex-direction:column;gap:16px;align-items:center;text-align:center;margin-top:120px}
  .card{background:var(--glass-strong);backdrop-filter:blur(6px) saturate(1.2);border-radius:16px;padding:16px;width:min(560px,92vw);box-shadow:var(--shadow)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
  .input{width:100%;padding:14px 16px;font-size:16px;border-radius:12px;border:1px solid #e5e7eb;outline:0}
  .btn{background:var(--primary);color:#fff;padding:14px 20px;border:0;border-radius:var(--btn-radius);font-weight:var(--btn-weight);font-size:16px;transition:.15s}
  .btn:hover{background:var(--accent)}
  .btn.secondary{background:#fff;color:#111;border:1px solid #111}
  .helper{background:#fff;color:#111;border-radius:10px;padding:10px 14px;box-shadow:0 6px 20px rgba(0,0,0,.2);font-size:14px}

  /* ====== JOGO (imagem 1) ====== */
  .brand-cluster-left{
    position:absolute;top:24px;left:24px;z-index:7;
    display:flex;flex-direction:column;gap:18px;align-items:flex-start
  }
  .logo-game-card img{width:300px;height:auto}
  .logo-arco img{width:140px;height:auto}
  @media (max-width:1024px){
    .logo-game-card img{width:240px}
    .logo-arco img{width:110px}
  }

  .top-right-actions{
    position:absolute;top:16px;right:16px;z-index:7;display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:flex-end
  }
  .hud{display:flex;gap:10px;align-items:center;flex-wrap:wrap;background:var(--hud-bg);padding:8px 10px;border-radius:14px;box-shadow:var(--shadow)}
  .pill{color:#1c160f;background:var(--hud-chip);border:0;padding:6px 12px;border-radius:12px;font-weight:900;display:flex;gap:6px;align-items:center}
  .pill b{color:#1c160f}
  .donate-btn{white-space:nowrap;border-radius:16px;padding:12px 18px;box-shadow:var(--shadow)}

  .arena{position:relative;width:min(1200px,92vw);height:min(74vh,780px);border-radius:16px;overflow:hidden}
  .arena .layer{position:absolute;inset:0}
  .sprite-img{max-width:100%;max-height:100%;object-fit:contain;background:transparent}

  /* posi√ß√µes fixas (desktop) */
  .naro{
    position:absolute;bottom:2px;left:0;
    display:flex;align-items:flex-end;justify-content:center
  }
  .cage{
    position:absolute;top:0;left:50%;transform:translateX(-50%);
    display:flex;align-items:flex-end;justify-content:center
  }

  .balloon{position:absolute;bottom:240px;padding:10px 12px;max-width:420px;border-radius:12px;background:#fff;border:1px solid rgba(17,17,17,.08);box-shadow:0 6px 20px rgba(0,0,0,.18);opacity:0;transform:translateY(6px);transition:.25s;white-space:nowrap;pointer-events:none}
  .balloon.show{opacity:1;transform:translateY(0)}

  /* ====== MOBILE ====== */
  @media (max-width: 767px){
    .menu-logos{top:10px;left:10px;right:10px}
    .menu-logo-left img{width:96px}
    .menu-logo-right img{width:180px}
    .content{margin-top:80px}

    .arena{ width: 95vw; height: 68vh; }
    .top-right-actions{ top:8px; left:8px; right:8px; justify-content:center; gap:8px; }
    .hud{ width:100%; justify-content:center; gap:8px; }
    .pill{ padding:6px 10px; }
    .donate-btn{ padding:10px 12px; }

    .balloon{ bottom:188px; max-width:280px; }
    .cage{ top:64px; } /* leve respiro no topo no mobile */
  }

  .mobile-drop{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;width:80vw;max-width:480px;z-index:30}
  @media (min-width:768px){.mobile-drop{display:none}}

  .overlay{position:fixed;inset:0;background:var(--modal-bg);display:none;align-items:center;justify-content:center;z-index:50}
  .overlay.show{display:flex}
  .modal{background:var(--modal-card);color:var(--modal-text);border-radius:18px;width:min(520px,92vw);padding:22px;text-align:center;box-shadow:0 14px 50px rgba(0,0,0,.35)}
  .modal h2{margin:0 0 8px}
  .modal .actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:14px}
</style>
</head>
<body>
<div class="app" id="app">
  <!-- ===== MENU (imagem 2) ===== -->
  <section id="menuPage" class="page">
    <div id="menuBg" class="bg"></div>

    <div class="menu-logos">
      <div class="menu-logo-left"><img id="menuLogoLeft" alt="Logo ARCO"></div>
      <div class="menu-logo-right card-white"><img id="menuLogoRight" alt="Logo do jogo"></div>
    </div>

    <div class="content">
      <div class="card">
        <div class="row" style="margin-bottom:10px">
          <input id="userName" class="input" placeholder="Seu nome" autocomplete="name" />
        </div>
        <div class="row">
          <button id="startBtn" class="btn">Iniciar</button>
          <a class="btn secondary" href="https://www.ongarco.org/quero-ajudar" target="_blank" rel="noopener">DOAR AGORA</a>
        </div>
      </div>
      <div class="helper">PC: use a <b>Barra de Espa√ßo</b> ‚Ä¢ Celular: toque em <b>Pegue o Naro</b></div>
    </div>
  </section>

  <!-- ===== JOGO (imagem 1) ===== -->
  <section id="gamePage" class="page hidden">
    <div id="gameBg" class="bg"></div>

    <!-- cluster topo-esquerdo como no mock -->
    <div class="brand-cluster-left">
      <div class="logo-game-card card-white"><img id="gameLogoCard" alt="Logo do jogo"></div>
      <div class="logo-arco"><img id="gameLogoLeft" alt="Logo ARCO"></div>
    </div>

    <div class="top-right-actions">
      <div class="hud">
        <div class="pill pill-time">‚è± <b id="time">00:00</b></div>
        <div class="pill pill-speed">‚ö° <b id="speed">0</b></div>
        <div class="pill pill-score">‚≠ê <b id="score">0</b></div>
        <div class="pill pill-level">üéØ <b id="level">1</b></div>
      </div>
      <a class="btn donate-btn" href="https://www.ongarco.org/quero-ajudar" target="_blank" rel="noopener">DOAR AGORA</a>
    </div>

    <div class="arena" id="arena">
      <div class="layer">
        <div class="naro" id="naro"><img id="naroImg" class="sprite-img" alt="Naro"></div>
        <div class="cage" id="cage"><img id="cageImg" class="sprite-img" alt="Gaiola"></div>
        <div class="balloon" id="balloon"></div>
      </div>
    </div>

    <div class="mobile-drop">
      <button id="mobileDropBtn" class="btn" style="width:100%;">Pegue o Naro</button>
    </div>
  </section>
</div>

<!-- MODAL -->
<div id="overlay" class="overlay" role="dialog" aria-modal="true">
  <div class="modal">
    <h2 id="modalTitle">Resultado</h2>
    <p id="modalMsg">Mensagem</p>
    <div class="actions">
      <button id="modalPrimary" class="btn">Pr√≥ximo n√≠vel</button>
      <button id="modalSecondary" class="btn secondary">SALVAR A DEMOCRACIA</button>
    </div>
  </div>
</div>

<script>
/** ====== ASSETS ====== **/
const ASSETS = {
  bgDesktop: './bg-desktop.jpg',
  bgMobile:  './bg-mobile.jpg',
  naro:      './naro.png',
  logoGame:  './logo-game.png',
  cage:      './cage.png',
  logoMenu:  './logo-menu.png',   // ARCO
  logoGameCard: './logo-game.png' // mesmo do jogo
};

/** ====== DIMENS√ïES ORIGINAIS ====== **/
const NARO_W0 = 480, NARO_H0 = 1080;
const CAGE_W0 = 864, CAGE_H0 = 1080;

/** ====== ESTADO / PAR√ÇMETROS ====== **/
let state = {
  userName:'', level:1, score:0, startedAt:0, elapsed:0, playing:false,
  dir:1, x:0, vx:0, naroW:0, naroH:0,
  cageDir:1, cageX:0, cageDropping:false, cageW:0, cageH:0, suspendedTop:0
};

const params = {
  baseSpeed:220, speedIncreasePerLevel:60, speedRampByTime:0.012,
  cagePatrolSpeed:180,
  dropSpeed:980,
  hitboxInnerPadding:14,
  minOverlapToCapture:0.33,
  balloonIntervalRangeMs:[4000,9000], balloonDurationMs:2500,
  balloons:["Isso nunca vai dar em nada!","Acabou a mamata?!","Eu sou imbroch√°vel!","Fake news!"],
  transparentWhiteThreshold:242
};

function $(id){return document.getElementById(id)}
function clamp(v,min,max){return Math.max(min, Math.min(max,v))}
function fmtTime(sec){const m=Math.floor(sec/60), s=Math.floor(sec%60); return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;}
function isMobile(){ return window.matchMedia('(max-width: 767px)').matches; }
function currentBg(){ return isMobile()? (ASSETS.bgMobile || ASSETS.bgDesktop) : (ASSETS.bgDesktop || ASSETS.bgMobile); }

/** (opcional) remove branco quase puro para garantir transpar√™ncia **/
function makeWhiteTransparent(url, threshold=params.transparentWhiteThreshold){
  return new Promise((resolve)=>{
    const img = new Image(); img.crossOrigin = 'anonymous';
    img.onload = ()=>{
      const c=document.createElement('canvas'); c.width=img.width; c.height=img.height;
      const ctx=c.getContext('2d'); ctx.drawImage(img,0,0);
      const data=ctx.getImageData(0,0,c.width,c.height); const d=data.data; let changed=false;
      for(let i=0;i<d.length;i+=4){ const r=d[i],g=d[i+1],b=d[i+2]; if(r>=threshold&&g>=threshold&&b>=threshold){d[i+3]=0;changed=true;} }
      if(changed){ ctx.putImageData(data,0,0); resolve(c.toDataURL('image/png')); } else resolve(url);
    };
    img.onerror=()=>resolve(url);
    img.src=url+'?v='+Date.now();
  });
}

/** Layout proporcional dos sprites p/ bater com os mockups */
function layoutSprites(){
  const arena = $('arena').getBoundingClientRect();

  // Tamanhos
  const cageH = isMobile()? Math.round(arena.height * 0.52) : Math.round(arena.height * 0.58);
  const sCage = cageH / CAGE_H0; const cageW = Math.round(CAGE_W0 * sCage);

  const naroH = isMobile()? Math.round(arena.height * 0.44) : Math.round(arena.height * 0.48);
  const sNaro = naroH / NARO_H0; const naroW = Math.round(NARO_W0 * sNaro);

  state.cageH=cageH; state.cageW=cageW; state.naroH=naroH; state.naroW=naroW;

  const cageEl=$('cage'), naroEl=$('naro');
  cageEl.style.width=cageW+'px'; cageEl.style.height=cageH+'px';
  naroEl.style.width=naroW+'px'; naroEl.style.height=naroH+'px';

  // Topo no desktop; leve respiro no mobile
  state.suspendedTop = isMobile()? 64 : 0;
  cageEl.style.top = state.suspendedTop+'px';

  // garantir X dentro dos limites atuais
  const maxNaroX = arena.width - naroW;
  state.x = clamp(state.x, 0, maxNaroX);
  naroEl.style.left = state.x+'px';

  const maxCageX = arena.width - cageW;
  if(cageEl.dataset.x===undefined){
    const start = Math.round(arena.width*0.72 - cageW/2); // come√ßa mais √† direita como no mock
    cageEl.dataset.x = clamp(start, 0, maxCageX);
  }
  cageEl.style.left = clamp(Number(cageEl.dataset.x), 0, maxCageX) + 'px';
}

async function loadImages(){
  const bg=currentBg();
  $('menuBg').style.backgroundImage=`url(${bg})`;
  $('gameBg').style.backgroundImage=`url(${bg})`;

  $('menuLogoLeft').src=ASSETS.logoMenu;
  $('menuLogoRight').src=ASSETS.logoGame;

  $('gameLogoCard').src=ASSETS.logoGame;
  $('gameLogoLeft').src=ASSETS.logoMenu;

  $('naroImg').src=await makeWhiteTransparent(ASSETS.naro);
  $('cageImg').src=await makeWhiteTransparent(ASSETS.cage);

  setTimeout(layoutSprites,50);
  window.addEventListener('resize', layoutSprites);
}

function showMenu(){ $('menuPage').classList.remove('hidden'); $('gamePage').classList.add('hidden'); $('overlay').classList.remove('show'); state.playing=false; state.cageDropping=false; }
function showGame(){ $('menuPage').classList.add('hidden'); $('gamePage').classList.remove('hidden'); $('overlay').classList.remove('show'); }

/** Bal√µes **/
let balloonTimer=null;
function scheduleBalloon(){
  clearTimeout(balloonTimer);
  if(!params.balloons.length) return;
  const [min,max]=params.balloonIntervalRangeMs;
  const wait=Math.floor(min + Math.random()*(max-min));
  balloonTimer=setTimeout(()=>{
    const t=params.balloons[Math.floor(Math.random()*params.balloons.length)];
    showBalloon(t);
    setTimeout(hideBalloon, params.balloonDurationMs);
    scheduleBalloon();
  }, wait);
}
function showBalloon(t){
  const b=$('balloon'); b.textContent=t;
  const naro=$('naro').getBoundingClientRect();
  const arena=$('arena').getBoundingClientRect();
  const left=clamp((naro.left-arena.left)+naro.width/2-120, 8, arena.width-250);
  b.style.left=left+'px'; b.classList.add('show');
}
function hideBalloon(){ $('balloon').classList.remove('show'); }

/** ====== HIT TEST ====== **/
function getInnerCageRect(){
  const cage=$('cage').getBoundingClientRect();
  const pad=params.hitboxInnerPadding;
  return {
    left:cage.left+pad,
    right:cage.right-pad,
    top:cage.top+pad,
    bottom:cage.bottom-pad,
    width:Math.max(0,(cage.right-pad)-(cage.left+pad)),
    height:Math.max(0,(cage.bottom-pad)-(cage.top+pad))
  };
}
function getNaroRect(){ return $('naro').getBoundingClientRect(); }
function centerOf(rect){ return { x:(rect.left+rect.right)/2, y:(rect.top+rect.bottom)/2 }; }
function intersectionArea(a,b){
  const left=Math.max(a.left,b.left), right=Math.min(a.right,b.right);
  const top=Math.max(a.top,b.top), bottom=Math.min(a.bottom,b.bottom);
  const w=Math.max(0, right-left), h=Math.max(0, bottom-top);
  return w*h;
}
function naroCaptured(){
  const inner=getInnerCageRect();
  const naro=getNaroRect();

  if(naro.left>=inner.left && naro.right<=inner.right && naro.top>=inner.top && naro.bottom<=inner.bottom) return true;
  const c=centerOf(naro);
  if(c.x>=inner.left && c.x<=inner.right && c.y>=inner.top && c.y<=inner.bottom) return true;

  const inter=intersectionArea(inner, naro);
  const ratio=inter/((naro.width||1)*(naro.height||1));
  return ratio >= params.minOverlapToCapture;
}

/** ====== JOGO ====== **/
function resetRound(){
  state.startedAt=performance.now(); state.elapsed=0;
  state.dir = Math.random()<0.5 ? -1 : 1;
  state.vx=0;
  state.cageDir = Math.random()<0.5 ? -1 : 1;
  state.cageDropping=false;

  $('cage').style.top = state.suspendedTop+'px';
  layoutSprites(); updateHUD(); scheduleBalloon();
}

function currentSpeed(){
  const base=params.baseSpeed + params.speedIncreasePerLevel*(state.level-1);
  const ramp=1 + params.speedRampByTime * (state.elapsed/1000);
  return base*ramp;
}
function updateHUD(){
  $('time').textContent = fmtTime(state.elapsed/1000);
  $('level').textContent = state.level;
  $('speed').textContent = Math.round(currentSpeed());
  $('score').textContent = state.score;
}

function dropCage(){ if(state.playing && !state.cageDropping){ state.cageDropping=true; } }

let raf=null;
function loop(ts){
  if(!state.playing){ raf=requestAnimationFrame(loop); return; }
  if(!state.startedAt) state.startedAt=ts;
  state.elapsed=ts-state.startedAt;

  const arena=$('arena').getBoundingClientRect();
  const naroEl=$('naro'); const cageEl=$('cage');

  // Naro com wrap-around
  const v=currentSpeed(); state.vx=v*(1/60);
  state.x += state.vx*state.dir;
  const maxNaroX = arena.width - state.naroW;
  if(state.x > maxNaroX){ state.x = -state.naroW + 1; }
  if(state.x < -state.naroW){ state.x = maxNaroX - 1; }
  naroEl.style.left = Math.round(state.x)+'px';

  // Gaiola com wrap-around enquanto suspensa
  if(!state.cageDropping){
    const patrolV=(params.cagePatrolSpeed + 30*(state.level-1))*(1/60);
    const maxCageX = arena.width - state.cageW;
    let x = Number(cageEl.dataset.x ?? (arena.width/2 - state.cageW/2));
    x += patrolV*state.cageDir;

    if(x > maxCageX){ x = -state.cageW + 1; }
    if(x < -state.cageW){ x = maxCageX - 1; }

    cageEl.dataset.x = x;
    cageEl.style.left = Math.round(x)+'px';
  }

  // Queda
  if(state.cageDropping){
    const curTop=parseFloat(getComputedStyle(cageEl).top);
    const step=params.dropSpeed*(1/60);
    const ground=arena.height - state.cageH + 6;
    const next=Math.min(curTop+step, ground);
    cageEl.style.top=next+'px';
    if(next>=ground){
      state.cageDropping=false;
      showResult(naroCaptured());
    }
  }

  updateHUD();
  raf=requestAnimationFrame(loop);
}

function showResult(win){
  state.playing=false;
  const name=state.userName||'Voc√™';
  $('overlay').classList.add('show');
  if(win){
    $('modalTitle').textContent='Parab√©ns!';
    $('modalMsg').textContent=`Parab√©ns, ${name}, voc√™ ajudou a salvar a nossa democracia!`;
    $('modalPrimary').textContent='Pr√≥ximo n√≠vel';
    $('modalSecondary').classList.add('hidden');
    state.score+=100;
  }else{
    $('modalTitle').textContent='Falhou';
    $('modalMsg').textContent=`${name} VOC√ä FALHOU E O NARO EST√Å SOLTO. TENTE NOVAMENTE PARA SALVAR A DEMOCRACIA.`;
    $('modalPrimary').textContent='Tentar novamente';
    $('modalSecondary').textContent='SALVAR A DEMOCRACIA';
    $('modalSecondary').classList.remove('hidden');
  }
}

/** CONTROLES **/
$('startBtn').addEventListener('click', startGame);
const mobileBtn = $('mobileDropBtn'); if(mobileBtn) mobileBtn.addEventListener('click', dropCage);
document.addEventListener('keydown',(e)=>{
  if(e.code==='Space' && !$('menuPage').classList.contains('hidden')){ e.preventDefault(); startGame(); return; }
  if(e.code==='Space' && state.playing){ e.preventDefault(); dropCage(); }
});
$('modalPrimary').addEventListener('click', ()=>{ $('overlay').classList.remove('show'); if(state.score>0){ state.level++; } state.playing=true; resetRound(); });
$('modalSecondary').addEventListener('click', ()=>{ $('overlay').classList.remove('show'); state.playing=true; resetRound(); });

function startGame(){
  state.userName = $('userName').value.trim();
  state.level = state.level || 1;
  state.playing = true;
  $('overlay').classList.remove('show');
  showGame(); resetRound();
}

/** BOOT **/
function init(){ loadImages(); showMenu(); loop(0); }
init();
</script>
</body>
</html>
